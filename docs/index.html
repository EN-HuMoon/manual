<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>花月谷教學手冊</title>

  <style>
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans TC", Arial;
      background: linear-gradient(135deg,#0f172a,#1e293b);
      color:#fff;
      display:flex;
      justify-content:center;
      align-items:center;
      min-height:100vh;
      padding:24px;
    }

    .container{
      width:1000px;
      max-width:95%;
      background:rgba(255,255,255,0.05);
      border-radius:20px;
      padding:22px 22px 26px;
      box-shadow:0 20px 50px rgba(0,0,0,0.4);
      backdrop-filter: blur(18px);
    }

    /* ✅ 上方分類按鈕（現代玻璃風） */
    .tabs{
      display:flex;
      gap:12px;
      margin-bottom:14px;
      flex-wrap:wrap;
    }
    .tab{
      padding:9px 16px;
      border-radius:999px;
      cursor:pointer;
      font-size:14px;
      background:rgba(255,255,255,0.08);
      border:1px solid rgba(255,255,255,0.15);
      transition: transform 140ms ease, background 180ms ease, box-shadow 180ms ease;
      user-select:none;
    }
    .tab:hover{
      background:rgba(99,102,241,0.22);
      box-shadow:0 10px 26px rgba(99,102,241,0.12);
      transform: translateY(-1px);
    }
    .tab.active{
      background: linear-gradient(90deg, rgba(99,102,241,.95), rgba(34,211,238,.85));
      border-color: transparent;
      box-shadow:0 12px 30px rgba(99,102,241,0.28);
    }

    /* ✅ 圖片區 */
    .viewer{
      position:relative;
      display:flex;
      justify-content:center;
      align-items:center;
      padding: 10px 40px; /* 左右留空，按鈕不壓圖 */
    }

    /* ✅ 兩張圖片重疊做「平移 + 淡入淡出」 */
    #slideA, #slideB{
      max-width:100%;
      max-height:460px;
      border-radius:16px;
      transition: transform 0.42s ease, opacity 0.42s ease;
      will-change: transform, opacity;
      box-shadow: 0 10px 40px rgba(0,0,0,.35);
      user-select:none;
      -webkit-user-drag:none;

      /* ✅ 一點點抗閃爍：讓瀏覽器更穩定合成 */
      backface-visibility: hidden;
      transform-style: preserve-3d;
    }
    #slideA{
      opacity:1;
      transform: translateX(0);
      position:relative;
      z-index:1;
    }
    #slideB{
      position:absolute;
      z-index:2;
      opacity:0;
      transform: translateX(0);
    }

    /* ✅ 圓形箭頭 */
    .arrow{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      width:44px;
      height:44px;
      display:grid;
      place-items:center;
      font-size:28px;
      line-height:1;
      cursor:pointer;
      user-select:none;
      border-radius:50%;
      background:rgba(15,23,42,0.55);
      border:1px solid rgba(255,255,255,0.18);
      box-shadow:0 10px 30px rgba(0,0,0,0.25);
      transition: transform 140ms ease, background 140ms ease, box-shadow 180ms ease, opacity 140ms ease;
      backdrop-filter: blur(10px);
      z-index: 5;
    }
    .arrow:hover{
      background:rgba(99,102,241,0.28);
      box-shadow:0 10px 35px rgba(99,102,241,0.18);
      transform:translateY(-50%) scale(1.05);
    }
    .arrow:active{
      transform:translateY(-50%) scale(0.98);
    }
    .arrow.disabled{
      opacity:0.35;
      pointer-events:none;
    }
    .left{ left:-18px; }
    .right{ right:-18px; }

    /* ✅ 圖片下方：現代玻璃資訊區 */
    .panel{
      margin-top: 18px;
      padding: 16px 16px 14px;
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 14px 40px rgba(0,0,0,.28);
      backdrop-filter: blur(14px);
    }

    /* ✅ 防跳動：固定文字高度 */
    .text{
      margin-top:0;
      line-height:1.7;
      font-size:16px;
      opacity:0.92;
      white-space: pre-line;

      height: 140px;     /* 你想更高就改 180/220 */
      overflow:auto;
      padding-right: 6px;
      scrollbar-gutter: stable;
      transition: opacity .18s ease;
    }
    .text::-webkit-scrollbar{ width:10px; }
    .text::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.18);
      border-radius: 999px;
      border: 2px solid rgba(0,0,0,0);
      background-clip: padding-box;
    }
    .text::-webkit-scrollbar-track{ background: rgba(255,255,255,.06); border-radius: 999px; }

    .stepbar{
      margin-top:12px;
      padding-top: 10px;
      border-top: 1px solid rgba(255,255,255,.10);
      font-size:13px;
      opacity:0.78;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }

    .hint{
      font-size:12px;
      opacity:0.85;
      margin-left: 6px;
    }

    .kbd{
      display:flex;
      gap:6px;
      align-items:center;
      font-size:12px;
      opacity:0.85;
    }
    .key{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size:12px;
      padding:2px 8px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
    }
  </style>
</head>

<body>
  <div class="container">

    <!-- ✅ 分類按鈕 -->
    <div class="tabs">
      <div class="tab active" data-guide="newbie">新手攻略</div>
      <div class="tab" data-guide="enhance">強化攻略</div>
      <div class="tab" data-guide="boss">BOSS攻略</div>
    </div>

    <div class="viewer">
      <div class="arrow left" id="btnPrev" title="上一頁 (←)">‹</div>

      <!-- ✅ 兩張圖疊加：保留平移 + 淡入淡出 -->
      <img id="slideA" src="" alt="step image A">
      <img id="slideB" src="" alt="step image B">

      <div class="arrow right" id="btnNext" title="下一頁 (→)">›</div>
    </div>

    <div class="panel">
      <div class="text" id="text">載入中...</div>

      <div class="stepbar">
        <div>
          <span id="stepLabel">Step 1 / 1</span>
          <span class="hint" id="hint"></span>
        </div>
        <div class="kbd">
          <span class="key">←</span><span class="key">→</span>
        </div>
      </div>
    </div>

  </div>

  <script>
    /* ✅ 三類攻略步驟：保留你目前資料 */
    const guides = {
      newbie: [
        {
          img: "assets/step1.png",
          text: "歡迎來到花月谷。\n接下來可以參考攻略遊玩。\n任何疑問也可以在論壇或群內詢問。",
          hint: "提示：用左右箭頭切換也支援鍵盤 ← →"
        },
        {
          img: "assets/step2.png",
          text: "註冊帳號和密碼。\n進入登入畫面後直接填入新的帳號密碼。\n即可完成註冊,請保護好自己的帳號密碼避免遺失。",
          hint: "提示：用左右箭頭切換也支援鍵盤 ← →"
        },
        {
          img: "assets/step3.png",
          text: "進入角色選擇畫面後。\n先點擊創立角色,選擇自己喜歡的職業即可。",
          hint: "提示：用左右箭頭切換也支援鍵盤 ← →"
        },
        {
          img: "assets/step4.png",
          text: "進入遊戲後會自動升至200級。\n背包內的[消耗欄]會給予一個萬能選單。\n之後所有功能都會依賴這個萬能選單工具。",
          hint: "提示：用左右箭頭切換也支援鍵盤 ← →"
        },
        {
          img: "assets/step5.png",
          text: "可先使用綜合功能內的[一鍵戰地]功能快速創立聯盟。\n聯盟可提供高額的戰力加成。",
          hint: "提示：用左右箭頭切換也支援鍵盤 ← →"
        },
        {
          img: "assets/step6.png",
          text: "一鍵戰地內的詞綴就是接下來自動創立的角色名稱前綴。\n例如輸入:測試戰地。\n則會創立:測試戰地英雄,測試戰地黑騎士,測試戰地火毒...等等",
          hint: "提示：用左右箭頭切換也支援鍵盤 ← →"
        },
        {
          img: "assets/step9.png",
          text: "接著利用[任務速通]快速完成前置任務。\n還可以解開ARC/AUT欄位,這非常重要。",
          hint: "提示：用左右箭頭切換也支援鍵盤 ← →"
        },
        {
          img: "assets/step10.png",
          text: "進入[轉職中心]的介面。\n完成 一 ~ 六轉(依照目前的角色等級)。\n完成轉職後會自動學習對應技能。",
          hint: "提示：用左右箭頭切換也支援鍵盤 ← →"
        },
        {
          img: "assets/step7.png",
          text: "創立完聯盟後也別忘了把[獎勵專區]內的所有獎勵全都領一遍。\n可以獲得大量前期需要的資源。",
          hint: "提示：用左右箭頭切換也支援鍵盤 ← →"
        },
        {
          img: "assets/step8.png",
          text: "之後把獎勵送的裝備都裝備上去後即可開始你的冒險。",
          hint: "提示：用左右箭頭切換也支援鍵盤 ← →"
        },
      ],

      enhance: [
        {
          img: "assets/step1.png",
          text: "（強化攻略）\n這裡先放第一步內容。\n把圖片與文字換成你的強化教學即可。",
          hint: "提示：用左右箭頭切換"
        },
        {
          img: "assets/step2.png",
          text: "（強化攻略）\n第二步內容占位。\n之後可擴充到更多步驟。",
          hint: "提示：也支援鍵盤 ← →"
        },
      ],

      boss: [
        {
          img: "assets/step1.png",
          text: "（BOSS攻略）\n這裡先放第一步內容。\n把圖片與文字換成你的BOSS教學即可。",
          hint: "提示：用左右箭頭切換"
        },
        {
          img: "assets/step2.png",
          text: "（BOSS攻略）\n第二步內容占位。\n之後可擴充到更多步驟。",
          hint: "提示：也支援鍵盤 ← →"
        },
      ],
    };

    // ===== 狀態 =====
    let currentGuide = "newbie";
    let steps = guides[currentGuide];

    let index = 0;
    let usingA = true;
    let animating = false;

    // ===== DOM =====
    const slideA = document.getElementById("slideA");
    const slideB = document.getElementById("slideB");
    const textEl = document.getElementById("text");
    const stepLabel = document.getElementById("stepLabel");
    const hintEl = document.getElementById("hint");
    const btnPrev = document.getElementById("btnPrev");
    const btnNext = document.getElementById("btnNext");
    const tabs = Array.from(document.querySelectorAll(".tab"));

    // ✅ 預載圖片快取（避免第一次切換閃圖）
    const preloadCache = new Map();
    function preloadImage(src){
      if (!src) return Promise.resolve();
      if (preloadCache.has(src)) return preloadCache.get(src);

      const p = new Promise((resolve) => {
        const img = new Image();
        img.onload = async () => {
          // decode 可以避免「載入完成但解碼未完成」造成的瞬間閃爍
          if (img.decode) {
            try { await img.decode(); } catch (e) {}
          }
          resolve();
        };
        img.onerror = () => resolve(); // 不阻塞
        img.src = src;
      });

      preloadCache.set(src, p);
      return p;
    }

    async function preloadGuideImages(list){
      // 不用 await 全部也行，但你這種教學頁通常圖片不多，先 preload 會最穩
      await Promise.all(list.map(s => preloadImage(s.img)));
    }

    function setNavState(){
      btnPrev.classList.toggle("disabled", index === 0);
      btnNext.classList.toggle("disabled", index === steps.length - 1);
      stepLabel.textContent = `Step ${index + 1} / ${steps.length}`;
      hintEl.textContent = steps[index].hint || "";
    }

    function setTextImmediate(){
      textEl.style.opacity = "0.0";
      setTimeout(() => {
        textEl.textContent = steps[index].text || "";
        textEl.scrollTop = 0;
        textEl.style.opacity = "0.92";
      }, 90);
    }

    async function hardSetStep(i){
      index = i;

      // ✅ 確保第一張也載入/解碼完成再顯示（避免初次切換殘影）
      await preloadImage(steps[index].img);

      slideA.src = steps[index].img;
      slideA.style.transition = "none";
      slideA.style.opacity = "1";
      slideA.style.transform = "translateX(0)";

      slideB.src = "";
      slideB.style.transition = "none";
      slideB.style.opacity = "0";
      slideB.style.transform = "translateX(0)";

      usingA = true;
      animating = false;

      // 恢復 transition（避免下一次動畫不見）
      slideA.offsetHeight;
      slideA.style.transition = "transform 0.42s ease, opacity 0.42s ease";
      slideB.style.transition = "transform 0.42s ease, opacity 0.42s ease";

      setTextImmediate();
      setNavState();
    }

    async function animateTo(nextIndex, dir){
      if (animating) return;
      if (nextIndex < 0 || nextIndex >= steps.length) return;

      animating = true;

      const current = usingA ? slideA : slideB;
      const next = usingA ? slideB : slideA;

      const outX = (dir === "next") ? -30 : 30;
      const inX  = (dir === "next") ? 30 : -30;

      // ✅ 先確保「下一張」已載入/解碼完成，再開始動畫（根治閃圖）
      const nextSrc = steps[nextIndex].img;
      await preloadImage(nextSrc);

      next.src = nextSrc;

      // next 先在旁邊 + 透明（先關 transition）
      next.style.transition = "none";
      next.style.opacity = "0";
      next.style.transform = `translateX(${inX}px)`;
      next.offsetHeight;

      // 開 transition
      current.style.transition = "transform 0.42s ease, opacity 0.42s ease";
      next.style.transition = "transform 0.42s ease, opacity 0.42s ease";

      requestAnimationFrame(() => {
        current.style.opacity = "0";
        current.style.transform = `translateX(${outX}px)`;

        next.style.opacity = "1";
        next.style.transform = "translateX(0)";
      });

      const onDone = () => {
        // current 重置並隱藏（但不清 src，避免某些瀏覽器重繪抖動）
        current.style.transition = "none";
        current.style.opacity = "0";
        current.style.transform = "translateX(0)";

        usingA = !usingA;
        index = nextIndex;

        setTextImmediate();
        setNavState();

        animating = false;
        next.removeEventListener("transitionend", onDone);
      };

      next.addEventListener("transitionend", onDone, { once: true });
    }

    function next(){
      if (index >= steps.length - 1) return;
      animateTo(index + 1, "next");
    }

    function prev(){
      if (index <= 0) return;
      animateTo(index - 1, "prev");
    }

    // 按鈕
    btnNext.addEventListener("click", next);
    btnPrev.addEventListener("click", prev);

    // 鍵盤
    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowRight") next();
      if (e.key === "ArrowLeft") prev();
    });

    // 分類切換
    tabs.forEach(t => {
      t.addEventListener("click", async () => {
        const g = t.getAttribute("data-guide");
        if (!g || g === currentGuide) return;

        currentGuide = g;
        steps = guides[currentGuide] || [];
        tabs.forEach(x => x.classList.toggle("active", x === t));

        if (!steps.length) {
          textEl.textContent = "此攻略尚未加入步驟。";
          slideA.src = "";
          slideB.src = "";
          index = 0;
          setNavState();
          return;
        }

        // ✅ 切換攻略時先 preload 該攻略，第一頁切換不閃
        await preloadGuideImages(steps);
        await hardSetStep(0);
      });
    });

    // 初始化
    (async function init(){
      if (!steps.length) {
        textEl.textContent = "請在 guides 裡加入教學資料。";
        btnPrev.classList.add("disabled");
        btnNext.classList.add("disabled");
        return;
      }

      // ✅ 初始化先 preload 當前攻略，避免第一次換頁閃上一張
      await preloadGuideImages(steps);
      await hardSetStep(0);
    })();
  </script>
</body>
</html>
